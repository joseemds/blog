---
import shiki from "shiki";

export type Props = {
	url: string;
	code: string;
};

const { code, url } = Astro.props;

const highlighter = await shiki.getHighlighter({
	theme: "github-dark",
	langs: ["js", "rust"],
});
const tokens = highlighter.codeToThemedTokens(code, "js");
const formattedCode = shiki.renderToHtml(tokens, {
	bg: "rgb(22, 27, 34)",
});

const [_https, _empty, _github, owner, repo, _blob, commitHash, ...path] =
	url.split("/");

const [filename, lineNumbers] = path.at(-1)?.split("#");
const [startLine, _endLine] = lineNumbers.replace("L", "").split("-");
---

<div
	class="flex flex-col max-w-md md:max-w-4xl mx-auto"
	style=`--start: ${startLine};`
>
	<div
		class="border border-red-900 flex flex-row itemd-center p-2 gap-8 text-xl text-sky-50 whitespace-nowrap overflow-hidden"
		style="background-color: #24292e; border-color: #30363d;"
	>
		<i class="ri-github-fill ri-xl"></i>
		<h4 class="text-blue-400 decoration-blue-500 underline">
			<a href={url} target="_blank"
				>{owner + "/" + repo + ":" + filename + "#" + commitHash}</a
			>
		</h4>
	</div>
	<div
		set:html={formattedCode}
		class="border overflow-auto"
		style="border-color: #30363d; background-color: rgb(22, 27, 34)"
	/>
</div>
